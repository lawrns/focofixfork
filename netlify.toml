[build]
  # Directory to change to before starting a build
  base = "."

  # Directory that contains the deploy-ready HTML files and assets generated by the build
  publish = ".next"

  # Install all dependencies, plugin, then build
  command = "npm ci && npm run build"

  # Functions directory
  functions = "netlify/functions"

[build.environment]
  # Node.js version for builds
  NODE_VERSION = "20"

  # Next.js build configuration
  NEXT_TELEMETRY_DISABLED = "1"

  # Supabase environment variables
  NEXT_PUBLIC_SUPABASE_URL = "https://czijxfbkihrauyjwcgfn.supabase.co"
  NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN6aWp4ZmJraWhyYXV5andjZ2ZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIxNzU5ODMsImV4cCI6MjA2Nzc1MTk4M30.0MYAeaLn3L1LYiGNrsWPIvuZUVq-z7MUvaigybzCnQ0"
  SUPABASE_SERVICE_ROLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN6aWp4ZmJraWhyYXV5andjZ2ZuIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MjE3NTk4MywiZXhwIjoyMDY3NzUxOTgzfQ._JnBgXZLk23daPdnCUksfvooIJk2r9mFyclO8MnvfQ8"

# Next.js plugin for pages only
[[plugins]]
  package = "@netlify/plugin-nextjs"

# API route redirects to Netlify functions
[[redirects]]
  from = "/api/organizations"
  to = "/.netlify/functions/organizations"
  status = 200

[[redirects]]
  from = "/api/projects"
  to = "/.netlify/functions/projects"
  status = 200

[[redirects]]
  from = "/api/projects/*"
  to = "/.netlify/functions/projects-id"
  status = 200

[dev]
  # Development server configuration
  port = 3000
  publish = ".next"
  functions = "netlify/functions"

# Build processing and headers are handled automatically by @netlify/plugin-nextjs
# HTTPS redirects are handled automatically by Netlify
